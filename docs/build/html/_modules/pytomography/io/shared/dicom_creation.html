

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pytomography.io.shared.dicom_creation &#8212; PyTomography 1.3.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/pytomography/io/shared/dicom_creation';</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../../index.html">
  
  
  
  
    
    
      
    
    
    <img src="../../../../_static/PT1.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../../../_static/PT1.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../usage.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../developers_guide.html">
                        Developer’s Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../external_data.html">
                        External Data
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../autoapi/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../usage.html">
                        Tutorials
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../developers_guide.html">
                        Developer’s Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../external_data.html">
                        External Data
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../../autoapi/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../../../index.html" class="nav-link">Module code</a></li>
    
    
    <li class="breadcrumb-item"><a href="../../../pytomography.html" class="nav-link">pytomography</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">pytomography.io.shared.dicom_creation</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for pytomography.io.shared.dicom_creation</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pytomography</span>
<span class="kn">from</span> <span class="nn">pydicom.uid</span> <span class="kn">import</span> <span class="n">generate_uid</span>
<span class="kn">from</span> <span class="nn">pydicom.dataset</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">FileDataset</span><span class="p">,</span> <span class="n">FileMetaDataset</span>
<span class="kn">from</span> <span class="nn">pydicom.sequence</span> <span class="kn">import</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn">pydicom.uid</span> <span class="kn">import</span> <span class="n">ImplicitVRLittleEndian</span>
<span class="kn">from</span> <span class="nn">pydicom.uid</span> <span class="kn">import</span> <span class="n">PYDICOM_IMPLEMENTATION_UID</span>

<div class="viewcode-block" id="get_file_meta"><a class="viewcode-back" href="../../../../autoapi/pytomography/io/shared/dicom_creation/index.html#pytomography.io.shared.dicom_creation.get_file_meta">[docs]</a><span class="k">def</span> <span class="nf">get_file_meta</span><span class="p">(</span><span class="n">SOP_instance_UID</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">SOP_class_UID</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileMetaDataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates DICOM file metadata given an SOP instance and class UID.</span>

<span class="sd">    Args:</span>
<span class="sd">        SOP_instance_UID (str): Identifier unique to each DICOM file</span>
<span class="sd">        SOP_class_UID (str): Identifier specifying imaging modality</span>

<span class="sd">    Returns:</span>
<span class="sd">        FileMetaDataset: Metadata for DICOM file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_meta</span> <span class="o">=</span> <span class="n">FileMetaDataset</span><span class="p">()</span>
    <span class="n">file_meta</span><span class="o">.</span><span class="n">FileMetaInformationGroupLength</span> <span class="o">=</span> <span class="mi">202</span>
    <span class="n">file_meta</span><span class="o">.</span><span class="n">FileMetaInformationVersion</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x01</span><span class="s2">&quot;</span>
    <span class="n">file_meta</span><span class="o">.</span><span class="n">TransferSyntaxUID</span> <span class="o">=</span> <span class="n">ImplicitVRLittleEndian</span>
    <span class="c1">#file_meta.MediaStorageSOPClassUID = &#39;1.2.840.10008.5.1.4.1.1.128&#39;</span>
    <span class="n">file_meta</span><span class="o">.</span><span class="n">MediaStorageSOPClassUID</span> <span class="o">=</span> <span class="n">SOP_class_UID</span>
    <span class="n">file_meta</span><span class="o">.</span><span class="n">MediaStorageSOPInstanceUID</span> <span class="o">=</span> <span class="p">(</span><span class="n">SOP_instance_UID</span><span class="p">)</span>  
    <span class="n">file_meta</span><span class="o">.</span><span class="n">ImplementationClassUID</span> <span class="o">=</span> <span class="n">PYDICOM_IMPLEMENTATION_UID</span>
    <span class="k">return</span> <span class="n">file_meta</span></div>

<div class="viewcode-block" id="generate_base_dataset"><a class="viewcode-back" href="../../../../autoapi/pytomography/io/shared/dicom_creation/index.html#pytomography.io.shared.dicom_creation.generate_base_dataset">[docs]</a><span class="k">def</span> <span class="nf">generate_base_dataset</span><span class="p">(</span><span class="n">SOP_instance_UID</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">SOP_class_UID</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileDataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates a base dataset with the minimal number of required parameters</span>

<span class="sd">    Args:</span>
<span class="sd">        SOP_instance_UID (str): Identifier unique to each DICOM file</span>
<span class="sd">        SOP_class_UID (str): Identifier specifying imaging modality</span>

<span class="sd">    Returns:</span>
<span class="sd">        FileDataset: DICOM dataset</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&quot;pydicom-reconstruction&quot;</span>
    <span class="n">file_meta</span> <span class="o">=</span> <span class="n">get_file_meta</span><span class="p">(</span><span class="n">SOP_instance_UID</span><span class="p">,</span> <span class="n">SOP_class_UID</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">FileDataset</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="p">{},</span> <span class="n">file_meta</span><span class="o">=</span><span class="n">file_meta</span><span class="p">,</span> <span class="n">preamble</span><span class="o">=</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\0</span><span class="s2">&quot;</span> <span class="o">*</span> <span class="mi">128</span><span class="p">)</span>
    <span class="n">add_required_elements_to_ds</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span></div>

<div class="viewcode-block" id="add_required_elements_to_ds"><a class="viewcode-back" href="../../../../autoapi/pytomography/io/shared/dicom_creation/index.html#pytomography.io.shared.dicom_creation.add_required_elements_to_ds">[docs]</a><span class="k">def</span> <span class="nf">add_required_elements_to_ds</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">FileDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds elements to dataset including timing and manufacturer details</span>

<span class="sd">    Args:</span>
<span class="sd">        ds (FileDataset): DICOM dataset that will be updated</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="c1"># Append data elements required by the DICOM standarad</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">SpecificCharacterSet</span> <span class="o">=</span> <span class="s2">&quot;ISO_IR 100&quot;</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">InstanceCreationDate</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">InstanceCreationTime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H%M%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">Manufacturer</span> <span class="o">=</span> <span class="s2">&quot;Qurit&quot;</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">ManufacturerModelName</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;PyTomography </span><span class="si">{</span><span class="n">pytomography</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">InstitutionName</span> <span class="o">=</span> <span class="s2">&quot;Qurit&quot;</span>
    <span class="c1"># Set the transfer syntax</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">is_little_endian</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">is_implicit_VR</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># Set values already defined in the file meta</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">SOPClassUID</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">file_meta</span><span class="o">.</span><span class="n">MediaStorageSOPClassUID</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">SOPInstanceUID</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">file_meta</span><span class="o">.</span><span class="n">MediaStorageSOPInstanceUID</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">ApprovalStatus</span> <span class="o">=</span> <span class="s2">&quot;UNAPPROVED&quot;</span></div>
    
<div class="viewcode-block" id="add_study_and_series_information"><a class="viewcode-back" href="../../../../autoapi/pytomography/io/shared/dicom_creation/index.html#pytomography.io.shared.dicom_creation.add_study_and_series_information">[docs]</a><span class="k">def</span> <span class="nf">add_study_and_series_information</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">FileDataset</span><span class="p">,</span> <span class="n">reference_ds</span><span class="p">:</span> <span class="n">FileDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds study and series information to dataset based on reference dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        ds (FileDataset): Dataset for which to add headers</span>
<span class="sd">        reference_ds (FileDataset): Dataset from which to copy headers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">StudyDate</span> <span class="o">=</span> <span class="n">reference_ds</span><span class="o">.</span><span class="n">StudyDate</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">SeriesDate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;SeriesDate&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">StudyTime</span> <span class="o">=</span> <span class="n">reference_ds</span><span class="o">.</span><span class="n">StudyTime</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">SeriesTime</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;SeriesTime&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">StudyDescription</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;StudyDescription&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">SeriesDescription</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;SeriesDescription&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">StudyInstanceUID</span> <span class="o">=</span> <span class="n">reference_ds</span><span class="o">.</span><span class="n">StudyInstanceUID</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">SeriesInstanceUID</span> <span class="o">=</span> <span class="n">generate_uid</span><span class="p">()</span>  <span class="c1"># TODO: find out if random generation is ok</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">StudyID</span> <span class="o">=</span> <span class="n">reference_ds</span><span class="o">.</span><span class="n">StudyID</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">SeriesNumber</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>  <span class="c1"># TODO: find out if we can just use 1 (Should be fine since its a new series)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">FrameOfReferenceUID</span> <span class="o">=</span>  <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s1">&#39;FrameOfReferenceUID&#39;</span><span class="p">,</span> <span class="n">generate_uid</span><span class="p">())</span></div>
    
<div class="viewcode-block" id="add_patient_information"><a class="viewcode-back" href="../../../../autoapi/pytomography/io/shared/dicom_creation/index.html#pytomography.io.shared.dicom_creation.add_patient_information">[docs]</a><span class="k">def</span> <span class="nf">add_patient_information</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">FileDataset</span><span class="p">,</span> <span class="n">reference_ds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds patient information to dataset based on reference dataset</span>

<span class="sd">    Args:</span>
<span class="sd">        ds (FileDataset): Dataset for which to add headers</span>
<span class="sd">        reference_ds (FileDataset): Dataset from which to copy headers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">PatientName</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;PatientName&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">PatientID</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;PatientID&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">PatientBirthDate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;PatientBirthDate&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">PatientSex</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;PatientSex&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">PatientAge</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;PatientAge&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">PatientSize</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;PatientSize&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">PatientWeight</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">,</span> <span class="s2">&quot;PatientWeight&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="create_ds"><a class="viewcode-back" href="../../../../autoapi/pytomography/io/shared/index.html#pytomography.io.shared.dicom_creation.create_ds">[docs]</a><span class="k">def</span> <span class="nf">create_ds</span><span class="p">(</span><span class="n">reference_ds</span><span class="p">:</span> <span class="n">FileDataset</span><span class="p">,</span> <span class="n">SOP_instance_UID</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">SOP_class_UID</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">modality</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a new DICOM dataset based on a reference dataset with all required headers. Because this is potentially used to save images corresponding to different modalities, the UIDs must be input arguments to this function. In addition, since some modalities require saving multiple slices whereby ``SOP_instance_UIDs`` may use some convention to specify slice number, these are also input arguments.</span>

<span class="sd">    Args:</span>
<span class="sd">        reference_ds (FileDataset): Dataset from which to copy all important headers such as patient information and study UID. </span>
<span class="sd">        SOP_instance_UID (str): Unique identifier for the particular instance (this is different for every DICOM file created)</span>
<span class="sd">        SOP_class_UID (str): Unique identifier for the imaging modality</span>
<span class="sd">        modality (str): String specifying imaging modality</span>

<span class="sd">    Returns:</span>
<span class="sd">        _type_: _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">generate_base_dataset</span><span class="p">(</span><span class="n">SOP_instance_UID</span><span class="p">,</span> <span class="n">SOP_class_UID</span><span class="p">)</span>
    <span class="n">add_study_and_series_information</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">reference_ds</span><span class="p">)</span>
    <span class="n">add_patient_information</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">reference_ds</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">Modality</span> <span class="o">=</span> <span class="n">modality</span>
    <span class="k">return</span> <span class="n">ds</span></div>
</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, Luke Polson.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.1.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>